/*! wenba 2015-06-22 author:Mickey */
function init(){refresh(),window.onhashchange=refresh,$("#searchInputBox").keyup(function(){var a=$("#searchInputBox").val().trim();$(".item").hide(),$(".item:contains('"+a+"')").show()}),React.render(React.createElement(LoginModal,null),document.getElementById("myModalDialog"))}function refresh(){React.render(React.createElement(View,null),document.getElementById("viewWrapper")),$('[data-toggle="popover"]').popover({trigger:"hover"}),$("#searchInputBox").val("")}function checkLogin(){return localStorage.user_id?!0:(React.render(React.createElement(LoginModal,null),document.getElementById("myModalDialog")),$("#myModal").modal(),!1)}function ajaxFail(){alert("连接服务器失败了！！♪(^∇^*)")}var AskForm=React.createClass({displayName:"AskForm",postQuestion:function(){if(checkLogin()){var a=React.findDOMNode(this.refs.title),b=React.findDOMNode(this.refs.des),c=new Date,d=c.getFullYear()+"-"+(c.getMonth()+1)+"-"+c.getDate()+" "+c.getHours()+":"+c.getMinutes(),e={title:a.value.trim(),des:b.value.trim(),user_id:localStorage.user_id,time:d};if(!e.title)return void a.focus();if(!e.des)return void b.focus();this.props.postQuestion(e),a.value="",b.value=""}},render:function(){return React.createElement("div",{id:"askForm",className:"right-form"},React.createElement("h3",null,"我要提问"),React.createElement("div",null,React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"newQuestionTitle"},"问题标题"),React.createElement("input",{type:"text",className:"form-control",id:"newQuestionTitle",ref:"title"})),React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"newQuestionDes"},"问题描述"),React.createElement("textarea",{className:"form-control",rows:"3",id:"newQuestionDes",ref:"des"})),React.createElement("button",{type:"submit",className:"btn btn-primary",onClick:this.postQuestion},"发布")))}}),AnswerForm=React.createClass({displayName:"AnswerForm",postAnswer:function(){if(checkLogin()){var a=React.findDOMNode(this.refs.answerInput),b=a.value;if(!b)return void a.focus();var c=new Date,d=c.getFullYear()+"-"+(c.getMonth()+1)+"-"+c.getDate()+" "+c.getHours()+":"+c.getMinutes(),e={question_id:this.props.question.id,content:b,user_id:localStorage.user_id,time:d};this.props.postAnswer(e),a.value=""}},render:function(){return React.createElement("div",{id:"answerForm",className:"right-form"},React.createElement("h3",null,"我要回答"),React.createElement("div",null,React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"newQuestionDes"},"答案"),React.createElement("textarea",{className:"form-control",rows:"3",id:"newQuestionDes",ref:"answerInput"})),React.createElement("button",{type:"submit",className:"btn btn-primary",onClick:this.postAnswer},"发布")))}}),LoginModal=React.createClass({displayName:"LoginModal",toRegister:function(){React.render(React.createElement(RegisterModal,null),document.getElementById("myModalDialog"))},login:function(){var a=React.findDOMNode(this.refs.account),b=React.findDOMNode(this.refs.password),c={account:a.value,password:b.value};return c.account?c.password?void $.post("api/user/login",c,function(a){return a>0?(localStorage.user_id=a,alert("登录成功"),$("#myModal").modal("hide"),void 0):void alert("用户名或密码错误，登录失败")}.bind(this)).fail(ajaxFail):void b.focus():void a.focus()},render:function(){return React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-label":"Close"},React.createElement("span",{"aria-hidden":"true"},"×")),React.createElement("h4",{className:"modal-title",id:"myModalLabel"},"登录")),React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"form-horizontal"},React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"inputUsername",className:"col-sm-2 control-label"},"用户名"),React.createElement("div",{className:"col-sm-10"},React.createElement("input",{type:"text",className:"form-control",id:"inputUsername",placeholder:"用户名",ref:"account"}))),React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"inputPassword",className:"col-sm-2 control-label"},"密码"),React.createElement("div",{className:"col-sm-10"},React.createElement("input",{type:"password",className:"form-control",id:"inputPassword",placeholder:"密码",ref:"password"}))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-default","data-dismiss":"modal"},"取消"),React.createElement("button",{type:"button",className:"btn btn-info",onClick:this.toRegister},"去注册"),React.createElement("button",{type:"button",className:"btn btn-primary",onClick:this.login},"登录")))}}),RegisterModal=React.createClass({displayName:"RegisterModal",toLogin:function(){React.render(React.createElement(LoginModal,null),document.getElementById("myModalDialog"))},register:function(){var a=React.findDOMNode(this.refs.account),b=React.findDOMNode(this.refs.password),c=React.findDOMNode(this.refs.nickname),d=React.findDOMNode(this.refs.signature),e=a.value,f=b.value,g=c.value,h=d.value,i=React.findDOMNode(this.refs.userType).value;if(!e)return void a.focus();if(!f)return void b.focus();if(!g)return void c.focus();if(!h)return void d.focus();var j=new Date,k={account:e,password:f,nickname:g,signature:h,userType:i,time:j.getTime()};$.post("api/user/register",k,function(b){b>0?(localStorage.user_id=b,alert("注册成功"),$("#myModal").modal("hide")):(alert("该用户名已注册，请重新输入"),a.focus())}.bind(this)).fail(ajaxFail)},render:function(){return React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-label":"Close"},React.createElement("span",{"aria-hidden":"true"},"×")),React.createElement("h4",{className:"modal-title",id:"myModalLabel"},"注册")),React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"form-horizontal"},React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"inputUsername",className:"col-sm-2 control-label"},"用户名"),React.createElement("div",{className:"col-sm-10"},React.createElement("input",{type:"text",className:"form-control",id:"inputUsername",placeholder:"用户名",ref:"account"}))),React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"inputPassword",className:"col-sm-2 control-label"},"密码"),React.createElement("div",{className:"col-sm-10"},React.createElement("input",{type:"password",className:"form-control",id:"inputPassword",placeholder:"密码",ref:"password"}))),React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"inputPassword",className:"col-sm-2 control-label"},"昵称"),React.createElement("div",{className:"col-sm-10"},React.createElement("input",{type:"text",className:"form-control",id:"inputNickname",placeholder:"昵称",ref:"nickname"}))),React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"inputPassword",className:"col-sm-2 control-label"},"个性签名"),React.createElement("div",{className:"col-sm-10"},React.createElement("input",{type:"text",className:"form-control",id:"inputSignature",placeholder:"个性签名",ref:"signature"}))),React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"inputUserType",className:"col-sm-2 control-label"},"用户类型"),React.createElement("div",{className:"col-sm-10"},React.createElement("select",{className:"form-control",ref:"userType",id:"inputUserType"},React.createElement("option",{value:"0"},"学生"),React.createElement("option",{value:"1"},"老师")))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-default","data-dismiss":"modal"},"取消"),React.createElement("button",{type:"button",className:"btn btn-info",onClick:this.toLogin},"去登录"),React.createElement("button",{type:"button",className:"btn btn-primary",onClick:this.register},"注册")))}}),Question=React.createClass({displayName:"Question",toQuestionDetail:function(){this.props.toQuestionDetail(this.props.question)},render:function(){var a=Math.round(4*Math.random()),b="./img/avatar/"+a+".jpg",c=null;return"1"==this.props.question.user.userType&&(c=React.createElement("span",{className:"glyphicon glyphicon-star",style:{color:"gold"}})),React.createElement("div",{className:"media question item",onClick:this.toQuestionDetail},React.createElement("div",{className:"media-left"},React.createElement("img",{className:"media-object",src:b,style:{width:80,height:80}})),React.createElement("div",{className:"media-body"},React.createElement("span",{className:"pull-right"},this.props.question.time),React.createElement("h4",{className:"media-heading"},this.props.question.title),React.createElement("span",{className:"user","data-toggle":"popover","data-content":this.props.question.user.signature,"data-placement":"bottom"},c,this.props.question.user.nickname),React.createElement("br",null),this.props.question.content))}}),QuestionList=React.createClass({displayName:"QuestionList",toQuestionDetail:function(a){this.props.toQuestionDetail(a)},render:function(){for(var a=[],b=0;b<this.props.questions.length;b++){var c=React.createElement(Question,{question:this.props.questions[b],key:this.props.questions[b].id,toQuestionDetail:this.toQuestionDetail});a.push(c)}return React.createElement("div",{className:"questionList"},a)}}),Answer=React.createClass({displayName:"Answer",getInitialState:function(){return{like:[]}},loadDataFromServer:function(){$.post("api/answer/"+this.props.answer.id+"/like/get/",{user_id:localStorage.user_id},function(a){this.setState({like:a})}.bind(this)).fail(ajaxFail)},componentDidMount:function(){this.loadDataFromServer()},addLike:function(){$.post("api/answer/"+this.props.answer.id+"/like/add/",{user_id:localStorage.user_id},function(a){"200"==a?(alert("成功点赞"),this.loadDataFromServer()):alert("你已经点过赞了~♪(^∇^*)")}.bind(this)).fail(ajaxFail)},render:function(){var a=null;return"1"==this.props.answer.user.userType&&(a=React.createElement("span",{className:"glyphicon glyphicon-star",style:{color:"gold"}})),React.createElement("div",{className:"answer item"},React.createElement("span",{className:"pull-right"},this.props.answer.time),React.createElement("span",null,React.createElement("span",{className:"user","data-toggle":"popover","data-content":this.props.answer.user.signature,"data-placement":"bottom"},a,this.props.answer.user.nickname)," 答曰："),React.createElement("p",null,this.props.answer.content),React.createElement("p",{style:{textAlign:"right",cursor:"pointer"},onClick:this.addLike},"赞（",this.state.like[0],"）"))}}),AnswerList=React.createClass({displayName:"AnswerList",render:function(){var a=this.props.answers.map(function(a){return React.createElement(Answer,{answer:a,key:a.id})});return React.createElement("div",{className:"answerList"},a)}}),QuestionDetail=React.createClass({displayName:"QuestionDetail",render:function(){return React.createElement("div",{className:"questionDetail"},React.createElement(Question,{question:this.props.question}),React.createElement(AnswerList,{answers:this.props.answers}))}}),AnswerHistory=React.createClass({displayName:"AnswerHistory",render:function(){return React.createElement("div",{className:"history"},React.createElement("h2",null,"我的回答"),React.createElement(AnswerList,{answers:this.props.answers}))}}),QuestionHistory=React.createClass({displayName:"QuestionHistory",toQuestionDetail:function(a){this.props.toQuestionDetail(a)},render:function(){return React.createElement("div",{className:"history"},React.createElement("h2",null,"我的提问"),React.createElement(QuestionList,{questions:this.props.questions,toQuestionDetail:this.toQuestionDetail}))}}),QuestionListView=React.createClass({displayName:"QuestionListView",getInitialState:function(){return{questions:[]}},loadDataFromServer:function(){$.get("api/question/all/",{},function(a){this.setState({questions:a}),$('[data-toggle="popover"]').popover({trigger:"hover"})}.bind(this)).fail(ajaxFail)},componentDidMount:function(){this.loadDataFromServer()},postQuestion:function(a){var b="api/question/add/";$.post(b,a,function(a){"200"==a&&alert("提问成功"),this.loadDataFromServer()}.bind(this)).fail(ajaxFail)},toQuestionDetail:function(a){this.props.toQuestionDetail(a)},render:function(){return React.createElement("div",{className:"container"},React.createElement("div",{className:"col-lg-8 col-sm-12"},React.createElement(QuestionList,{questions:this.state.questions,toQuestionDetail:this.toQuestionDetail})),React.createElement("div",{className:"col-lg-4"},React.createElement(AskForm,{postQuestion:this.postQuestion})))}}),QuestionDetailView=React.createClass({displayName:"QuestionDetailView",getInitialState:function(){return{answers:[]}},loadDataFromServer:function(){$.get("api/question/"+this.props.question.id+"/answers/",{},function(a){this.setState({answers:a}),$('[data-toggle="popover"]').popover({trigger:"hover"})}.bind(this)).fail(ajaxFail)},componentDidMount:function(){this.loadDataFromServer()},postAnswer:function(a){var b="api/answer/add/";console.log(a),$.post(b,a,function(a){"200"==a&&alert("回答成功"),this.loadDataFromServer()}.bind(this)).fail(ajaxFail)},render:function(){return React.createElement("div",{className:"container"},React.createElement("div",{className:"col-lg-8"},React.createElement(QuestionDetail,{question:this.props.question,answers:this.state.answers})),React.createElement("div",{className:"col-lg-4"},React.createElement(AnswerForm,{postAnswer:this.postAnswer,question:this.props.question})))}}),AnswerHistoryView=React.createClass({displayName:"AnswerHistoryView",getInitialState:function(){return checkLogin(),{answers:[]}},loadDataFromServer:function(){$.post("api/answer/history/",{user_id:localStorage.user_id},function(a){this.setState({answers:a}),$('[data-toggle="popover"]').popover({trigger:"hover"})}.bind(this)).fail(ajaxFail)},componentDidMount:function(){this.loadDataFromServer()},render:function(){return React.createElement("div",{className:"container"},React.createElement("div",{className:"col-lg-8"},React.createElement(AnswerHistory,{answers:this.state.answers})))}}),QuestionHistoryView=React.createClass({displayName:"QuestionHistoryView",getInitialState:function(){return checkLogin(),{questions:[]}},loadDataFromServer:function(){$.post("api/question/history/",{user_id:localStorage.user_id},function(a){this.setState({questions:a}),$('[data-toggle="popover"]').popover({trigger:"hover"})}.bind(this)).fail(ajaxFail)},componentDidMount:function(){this.loadDataFromServer()},toQuestionDetail:function(a){this.props.toQuestionDetail(a)},render:function(){return React.createElement("div",{className:"container"},React.createElement("div",{className:"col-lg-8"},React.createElement(QuestionHistory,{questions:this.state.questions,toQuestionDetail:this.toQuestionDetail})))}}),View=React.createClass({displayName:"View",getInitialState:function(){return{question:null}},toQuestionDetail:function(a){this.setState({question:a},function(){console.log(this.state),window.location.hash="#"+this.state.question.id})},getView:function(){var a=window.location.hash.substring(1);if(!a)return React.createElement(QuestionListView,{toQuestionDetail:this.toQuestionDetail});if(!isNaN(a)){return React.createElement(QuestionDetailView,{question:this.state.question})}return"questionHistory"==a?React.createElement(QuestionHistoryView,{toQuestionDetail:this.toQuestionDetail}):"answerHistory"==a?React.createElement(AnswerHistoryView,null):React.createElement(QuestionListView,null)},render:function(){var a=this.getView();return React.createElement("div",{className:"view"},a)}});$(init);